<!DOCTYPE html>

<html lang="ja">

<head>

	<meta charset="utf-8">

	<title>アカウント作成</title>

	<link rel="stylesheet" href="../css/reset.css">
	<link rel="stylesheet" href="../css/common.css">
	<link rel="stylesheet" href="../css/sign_up.css">
	<link rel="stylesheet" href="https://cdn.materialdesignicons.com/3.5.95/css/materialdesignicons.min.css">



</head>

<body>

	<header>
		<div id="halcinema">
			<img src="/images/logo_white.png" alt="ロゴ白">
			<h1>HAL CINEMA</h1>
		</div>
		<button id="pan" onclick="location.href='/'">＜地域選択画面</button>
	</header>


	<div id="wrap">


		<article>
			<!-- ここから編集 -->

			<section id="step">

				<div class="step1" v-bind:class="{active:pageCurrent === 1}">1</div>
				<div class="step2" v-bind:class="{active:pageCurrent === 2}">2</div>
				<div class="step3" v-bind:class="{active:pageCurrent === 3}">3</div>
				<div id="line"></div>
			</section>



			<section id="signup_cont">
				<!--            -------------------ここから切り替わる　　　------------------         -->
				<div v-if="pageCurrent === 1">
					<h2>
						アカウント作成
					</h2>
					<div id="signup">

						<form id="form">
							<p id="error" v-for="ErrMassage in errors">{{ ErrMassage }}</li>
							<div id="mail">
								<img src="../images/mail_icon.png" alt="メール">
								<h3>Mail</h3>
								<input type="text" name="email" v-model="Mail" placeholder="halcinema@gmail.com" />
							</div>
							<div id="password1">
								<img src="../images/password_icon.png" alt="パスワード">
								<h3>Pass1</h3>
								<input type="password" name="password1" v-model="pass1" placeholder="password1" />
							</div>
							<div id="password2">
								<img src="../images/password_icon.png" alt="パスワード">
								<h3>Pass2</h3>
								<input type="password" name="password2" v-model="pass2" placeholder="password2" />
								</p>
							</div>
							<div id="gender">
								<img src="../images/gender.png" alt="性別">
								<h3>Gender</h3>
								<div class="gender">
									<label for="men">男</label>
									<input type="radio" name="gender" value="0" v-model="gender" checked />
									<label for="women">女</label>
									<input type="radio" name="gender" value="1" v-model="gender" />
								</div>
							</div>
							<div id="birthday">
								<img src="../images/birthday.png" alt="生年月日">
								<h3>Birthday</h3>
								<div class="gender">
									<select name="birthday" v-model="bYear">
										<option value="" disabled>-</option>
										<option v-for="optionBirthday in signupBirthday" :key="optionBirthday"
											:value="optionBirthday">
											{{optionBirthday}}
										</option>
									</select>　年
									<select name="month" v-model="bMonth">
										<option value="" disabled>-</option>
										<option v-for="optionMonth in signupMonth" :key="optionMonth"
											:value="optionMonth">
											{{optionMonth}}
										</option>
									</select>　月
									<select name="day" v-model="bDay">
										<option value="" disabled>-</option>
										<option v-for="optionDay in signupDay" :key="optionDay" :value="optionDay">
											{{optionDay}}
										</option>
									</select>　日
								</div>
							</div>
							<input type="submit" @click="validate" value="次へ" id="next">
						</form>
					</div>
				</div>

				<!--            -------------------        確認ページ　　　------------------         -->
				<div v-else-if="pageCurrent === 2">
					<h2>
						この内容で登録しますか
					</h2>
					<p id="signup">- sign up confirmation -</p>
					<div id="signup">
						<p id="error" v-for="ErrMassage in errors">{{ ErrMassage }}</li>
						<div id="mail">
							<img src="../images/mail_icon.png" alt="メール">
							<h3>Mail</h3>
							<input type="text" name="email" placeholder="halcinema@gmail.com" v-bind:value="Mail" />
						</div>
						<div id="password1">
							<img src="../images/password_icon.png" alt="パスワード">
							<h3>Pass1</h3>
							<input type="password" name="password1" v-model="pass3" />
						</div>
						<div id="gender">
							<img src="../images/gender.png" alt="性別">
							<h3>Gender</h3>
							<div class="gender">
								<label for="men">男</label>
								<input type="radio" name="gender" value="0" v-model="gender" />
								<label for="women">女</label>
								<input type="radio" name="gender" value="1" v-model="gender" />
							</div>
						</div>
						<div id="birthday">
							<img src="../images/birthday.png" alt="生年月日">
							<h3>Birthday</h3>
							<div class="gender">
								<select name="birthday" v-model="bYear">
									<option value="" disabled>-</option>
									<option v-for="optionBirthday in signupBirthday" :key="optionBirthday"
										:value="optionBirthday">
										{{optionBirthday}}
									</option>
								</select>　年
								<select name="month" v-model="bMonth">
									<option value="" disabled>-</option>
									<option v-for="optionMonth in signupMonth" :key="optionMonth" :value="optionMonth">
										{{optionMonth}}
									</option>
								</select>　月
								<select name="day" v-model="bDay">
									<option value="" disabled>-</option>
									<option v-for="optionDay in signupDay" :key="optionDay" :value="optionDay">
										{{optionDay}}
									</option>
								</select>　日
							</div>
						</div>
						<input type="submit" value="次へ" id="next" @click="validate">
					</div>
				</div>
				</form>
				<!--            -------------------        登録完了　　　------------------         -->
				<div v-else-if="pageCurrent === 3">
					<h2>
						登録ありがとうございます。アカウント作成に成功しました。
					</h2>
					<p id="signup">- 内容変更は<a href="#">アカウント情報画面</a>で設定可能です -</p>
					<img id="thankyou" src="../images/thankyou.png" alt="thank you for register">
					<button onclick="location.href='../home/today_schedule'" id="next">ホームに戻る</button>
				</div>
				<!-- ここまで -->
			</section>

			<!-- ここまでを編集 -->
		</article>


	</div>



	<footer id="copyRight">
		<small>&copy; HAL CINEMA 2020.</small>
	</footer>

	<script src="/js/axios.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<!-- <script src="https://cdn.jsdelivr.net/npm/vuelidate@0.7.4/dist/validators.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vuelidate@0.7.4/dist/vuelidate.min.js"></script> -->

	<script>
		// アカウント登録処理
		const signupReq = async () => {
			const birth = document.getElementsByName("birthday")[0].value + '/' +
				document.getElementsByName("month")[0].value + '/' +
				document.getElementsByName("day")[0].value
			const formData = {
				email: document.getElementsByName("email")[0].value,
				password: document.getElementsByName("password1")[0].value,
				gender: document.getElementById("form").gender.value,
				birth: birth
			}

			// バリデート処理

			const result = await axios.post("/auth/signUp", { ...formData })
			console.log(result)
			if (result.status === 200) {
				// サインアップ成功処理
			}
			if (result.status === 403) {
				// サインアップ失敗処理
			}
			if (result.status === 409) {
				// メールアドレス重複時処理
			}
		}

		new Vue({
			el: '#wrap',
			data: {
				pageCurrent: 1,
				errors: [],
				Mail: null,
				pass1: null,
				pass2: null,
				pass3: null,
				gender: null,
				bYear: null,
				bMonth: null,
				bDay: null,
				signupBirthday: ['1900', '1901', '1902', '1903', '1904', '1905', '1906', '1907', '1908', '1910', '1911', '1912', '1913', '1914', '1915', '1916', '1917', '1918', '1919', '1920', '1921', '1922', '1923', '1924', '1925', '1926', '1927', '1928', '1929', '1930', '1931', '1932', '1933', '1934', '1935', '1936', '1937', '1938', '1939', '1940', '1941', '1942', '1943', '1944', '1945', '1946', '1947', '1948', '1949', '1950', '1951', '1952', '1953', '1954', '1955', '1956', '1957', '1958', '1959', '1960', '1961', '1962', '1963', '1964', '1965', '1966', '1967', '1968', '1969', '1970', '1971', '1972', '1973', '1974', '1975', '1976', '1977', '1978', '1979', '1980', '1981', '1982', '1983', '1984', '1985', '1986', '1987', '1988', '1989', '1990', '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020'],
				signupMonth: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
				signupDay: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
			},
			methods: {
				validate: function (e) {
					this.errors = [];
					if (!this.Mail) {
						this.errors.push('メールアドレスが入力されていません');
					} else if (!this.validateEmail(this.Mail)) {
						this.errors.push('有効なメールアドレスを入力してください');
					}
					if (!this.pass1) {
						this.errors.push('パスワードが入力されていません');
						console.log('pass1');
					}
					else if (!this.pass2) {
						this.errors.push('パスワードが入力されていません');
						console.log('pass2');
					}
					else if (this.pass1 !== this.pass2) {
						this.errors.push('パスワードが一致しません')
					}
					else if (!this.validatePassword(this.pass1)) {
						this.errors.push('半角英数字で６文字以上で入力してください');
					}
					else if (this.pass1 === this.pass2) {
						this.pass3 = this.pass1;
					}
					else if (!this.pass3) {
						this.errors.push('パスワードが入力されていません');
					} else if (!this.validatePassword(this.pass3)) {
						this.errors.push('半角英数字で６文字以上で入力してください');
					}
					if (this.gender === null) {
						this.errors.push('性別が入力されていません');
					}
					if (!this.bYear) {
						this.errors.push('誕生日が入力されていません');
					}
					else if (!this.bMonth) {
						this.errors.push('誕生日が入力されていません');
					}
					else if (!this.bDay) {
						this.errors.push('誕生日が入力されていません');
					}
					if (!this.errors.length) {

						this.pageCurrent++;
						return true;
					}
					e.preventDefault();
				},
				validateEmail: function (Mail) {
					const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
					return re.test(Mail);
				},
				validatePassword: function (pass1) {
					const pass = /^(?=.*?[a-z])(?=.*?\d)[a-z\d]{6,100}$/i;
					return pass.test(pass1);
				}
			}
		});
	</script>



</body>

</html>